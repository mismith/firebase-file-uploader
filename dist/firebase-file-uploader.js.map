{"version":3,"sources":["../index.js"],"names":[],"mappings":";;;;;;;;IAAM;;;;;;;0BACG,OAAO,KAAqB;OAAhB,+DAAS,qBAAO;;AACnC,OAAK,CAAE,KAAF,IAAW,CAAE,MAAM,MAAN,EAAc,OAAhC;;AAEA,OAAI,YAAY,EAAZ,CAH+B;;8BAK3B;AACP,cAAU,IAAV,CAAe,IAAI,OAAJ,CAAY,mBAAW;AACrC,SAAI,SAAS,IAAI,UAAJ,EAAT,CADiC;AAErC,SAAI,MAAM,CAAN,aAAoB,gBAApB,EAAsC;AACzC,aAAO,MAAP,GAAgB,aAAK;AACpB,eAAQ;AACP,aAAK,EAAE,MAAF,CAAS,MAAT;QADN,EADoB;OAAL,CADyB;AAMzC,UAAI,OAAO,MAAM,CAAN,EAAS,SAAT,EAAP,CANqC;AAOzC,UAAI,gBAAgB,IAAhB,EAAsB;AACzB,cAAO,aAAP,CAAqB,IAArB,EADyB;OAA1B,MAEO;;OAFP;MAPD,MAYO,IAAI,MAAM,CAAN,aAAoB,IAApB,EAA0B;AACpC,cAAO,MAAP,GAAgB,aAAK;AACpB,gBAAQ;AACP,eAAM,MAAM,CAAN,EAAS,IAAT;AACN,eAAM,MAAM,CAAN,EAAS,IAAT;AACN,eAAM,MAAM,CAAN,EAAS,IAAT;AACN,cAAK,EAAE,MAAF,CAAS,MAAT;SAJN,EADoB;QAAL,CADoB;AASpC,cAAO,aAAP,CAAqB,MAAM,CAAN,CAArB,EAToC;OAA9B;KAdmB,CAA3B;KANkC;;AAKnC,QAAI,IAAI,IAAI,CAAJ,EAAO,IAAI,MAAM,MAAN,EAAc,GAAjC,EAAsC;UAA9B,GAA8B;IAAtC;;AA6BA,UAAO,QAAQ,GAAR,CAAY,SAAZ,EAAuB,IAAvB,CAA4B,iBAAS;AAC3C,QAAI,GAAJ,EAAS;AACR,SAAI,eAAe,QAAf,EAAyB;;AAE5B,UAAI,MAAJ,EAAY;AACX,cAAO,IAAI,GAAJ,CAAQ,MAAM,CAAN,KAAY,IAAZ,CAAR,CAA0B,IAA1B,CAA+B;eAAQ;QAAR,CAAtC,CADW;OAAZ,MAEO;;AACN,YAAI,YAAY,EAAZ;AACJ,cAAM,GAAN,CAAU;gBAAQ,UAAU,IAAV,CAAe,IAAI,IAAJ,CAAS,IAAT,CAAf;SAAR,CAAV;AACA;YAAO,QAAQ,GAAR,CAAY,SAAZ,EAAuB,IAAvB,CAA4B,KAA5B;SAAP;WAHM;;;OAFP;MAFD,MASO;;AAEN,UAAI,MAAJ,EAAY;AACX,YAAI,IAAI,CAAJ,IAAS,MAAM,CAAN,CAAb;AAAuB,YAAI,CAAJ,IAAS,MAAM,CAAN,EAAS,CAAT,CAAT;QAAvB,OACO,GAAP,CAFW;OAAZ,MAGO;AACN,aAAM,GAAN,CAAU;eAAQ,IAAI,IAAJ,CAAS,IAAT;QAAR,CAAV,CADM;AAEN,cAAO,GAAP,CAFM;OAHP;MAXD;KADD,MAoBO;AACN,YAAO,KAAP,CADM;KApBP;IADkC,CAAnC,CAlCmC;;;;QAD/B","file":"firebase-file-uploader.js","sourcesContent":["class FirebaseFileUploader {\n\tprocess(files, ref, single = false) {\n\t\tif ( ! files || ! files.length) return;\n\n\t\tlet processed = [];\n\n\t\tfor(let i = 0; i < files.length; i++) {\n\t\t\tprocessed.push(new Promise(resolve => {\n\t\t\t\tlet reader = new FileReader();\n\t\t\t\tif (files[i] instanceof DataTransferItem) {\n\t\t\t\t\treader.onload = e => {\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\tsrc: e.target.result,\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t\tlet blob = files[i].getAsFile();\n\t\t\t\t\tif (blob instanceof Blob) {\n\t\t\t\t\t\treader.readAsDataURL(blob);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// @TODO: error?\n\t\t\t\t\t}\n\t\t\t\t} else if (files[i] instanceof File) {\n\t\t\t\t\treader.onload = e => {\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\tname: files[i].name,\n\t\t\t\t\t\t\tsize: files[i].size,\n\t\t\t\t\t\t\ttype: files[i].type,\n\t\t\t\t\t\t\tsrc: e.target.result,\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t\treader.readAsDataURL(files[i]);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\treturn Promise.all(processed).then(files => {\n\t\t\tif (ref) {\n\t\t\t\tif (ref instanceof Firebase) {\n\t\t\t\t\t// firebase reference\n\t\t\t\t\tif (single) {\n\t\t\t\t\t\treturn ref.set(files[0] || null).then(snap => files);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet deferreds = [];\n\t\t\t\t\t\tfiles.map(file => deferreds.push(ref.push(file)));\n\t\t\t\t\t\treturn Promise.all(deferreds).then(files);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// object / array (i.e. for local/draft manipulation)\n\t\t\t\t\tif (single) {\n\t\t\t\t\t\tfor(let k in files[0]) ref[k] = files[0][k];\n\t\t\t\t\t\treturn ref;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfiles.map(file => ref.push(file));\n\t\t\t\t\t\treturn ref;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn files;\n\t\t\t}\n\t\t});\n\t}\n}"]}